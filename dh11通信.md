# DHT11 温湿度传感器通信协议详解

## 1. 概述
DHT11 采用简化的**单总线 (Single-Wire)** 通信协议。这意味着电源线之外，只有一根数据线（DATA）用于微控制器（MCU）和传感器之间的双向通信。

* **通信模式**：半双工（同一时间只能发送或接收）。
* **主从关系**：MCU 是主机（Master），DHT11 是从机（Slave）。
* **空闲状态**：总线默认处于**高电平**状态（通常由上拉电阻维持）。

---

## 2. 数据包结构
一次完整的数据传输包含 **40 bit (5 字节)** 的数据。数据发送顺序是**高位在前 (MSB first)**。

**数据组成如下：**

| 顺序 | 内容 | 说明 |
| :--- | :--- | :--- |
| **第 1 字节** | 湿度整数部分 | 湿度值的整数部分 |
| **第 2 字节** | 湿度小数部分 | DHT11 此字节通常为 0 (保留) |
| **第 3 字节** | 温度整数部分 | 温度值的整数部分 |
| **第 4 字节** | 温度小数部分 | DHT11 此字节通常为 0 (保留) |
| **第 5 字节** | 校验和 | 用于验证数据准确性 |

> **校验规则**：
> `第1字节 + 第2字节 + 第3字节 + 第4字节 = 第5字节（只取末8位）`
> 如果计算结果等于第5字节，说明接收到的数据是正确的。

---

## 3. 通信全过程详解

通信过程严格遵循时序，分为三个主要阶段：**起始信号**、**响应信号**、**数据传输**。

### 第一阶段：主机发送起始信号 (唤醒传感器)
在空闲状态（高电平）下，MCU 需要发起“对话”：

1.  **拉低总线**：MCU 将数据线电平拉低。
2.  **保持低电平**：必须保持至少 **18ms**（毫秒）。这是为了确保 DHT11 能检测到起始信号。
3.  **拉高释放**：MCU 将数据线拉高，并释放总线，转为输入模式，准备接收传感器的回应。
4.  **等待**：MCU 等待 20-40us 左右。

### 第二阶段：传感器发送响应信号 (握手)
如果 DHT11 正常工作，它会检测到上述的起始信号，并做出回应：

1.  **DHT11 拉低**：传感器将总线拉低，保持约 **80us**。这表示“我在线，准备好了”。
2.  **DHT11 拉高**：传感器紧接着将总线拉高，保持约 **80us**。这表示“即将开始发送数据”。

> **注意**：如果 MCU 在发送起始信号后，没有检测到这个低-高电平的变化，说明传感器故障或连接断开。

### 第三阶段：数据传输 (0 和 1 的判定)
握手完成后，DHT11 开始连续发送 40 位数据。
**核心逻辑：通过“高电平持续时间的长短”来区分 0 和 1。**

每一位数据（Bit）都由两部分组成：
1.  **时隙头 (固定)**：一段约 **50us 的低电平**。这标志着一位数据的开始。
2.  **数据位 (可变)**：紧接在低电平之后的高电平长度决定了数值。

#### 逻辑 "0" 的表示：
* **50us 低电平** -> **26us ~ 28us 高电平**
* (看到高电平很短，就是 0)

#### 逻辑 "1" 的表示：
* **50us 低电平** -> **70us 高电平**
* (看到高电平较长，就是 1)

---

## 4. 通信结束
当 40 位数据发送完毕后：

1.  **结束信号**：DHT11 会再拉低总线 50us，标志传输结束。
2.  **释放总线**：DHT11 释放数据线，上拉电阻会将总线拉回**高电平**，进入空闲状态。

---

## 5. 时序图解 (逻辑示意)

```text
      [MCU起始]        [DHT11响应]           [数据传输...]
VCC  ____           _______       ___     _________     ____ ...
         |         |       |     |   |   |         |   |
GND      |_________|       |_____|   |___|         |___|
         >18ms      80us    80us  50us 26us  50us  70us
                                    (0)        (1)